%% Generic curves -- 3 sites only
load('G:\Shared drives\Lim_Lab\Sahla\snail enhancer\Imaging\snaSEmin binding site mutations/Dl_Twi');
x = 0:0.01:0.99;
ca = 400*normpdf(x,0.5,0.08)./1000;
cb = 400*normpdf(x,0.5,0.08)./1000;
c_twi = smooth(mean(Dl(1:8,:),1)); % smooth curve
cc = 400*normpdf(x,0.5,0.08)./1000; % normalize using smooth curve

ka = 10; % dl1 binding
kb = 52e11; % dl2 binding 
kc = 34e11; % twi binding
% kb = 16.5e11; % dl3 binding
% kz = 1/8.1e-4; % zld binding

% dl1 - dl3,twi del
m = @(w,ka,ca,cb,cc)((ca + (cb.*ka)/52e11 + (cc.*ka)./34e11 + (w(1)*ca.*cb)./52e11 + w(2)*(cb.*cc.*ka)./(52e11*34e11) + w(3)*(ca.*cc)./34e11 + w(4)*(ca.*cb.*cc)./(52e11*34e11))./....
    (ka + ca + (cb.*ka)./52e11 + (cc.*ka)./34e11 + (w(1)*ca.*cb)./52e11 + w(2)*(cb.*cc.*ka)./(52e11*34e11) + w(3)*(ca.*cc)./34e11 + w(4)*(ca.*cb.*cc)./(52e11*34e11)));
% dl1/3 - twi deletion
p = @(w,ka,ca,cb,cc)((ca + (cb.*ka)/16.5 + (cc.*ka)./34e11 + (w(1)*ca.*cb)./16.5 + w(2)*(cb.*cc.*ka)./(16.5*34e11) + w(3)*(ca.*cc)./34e11 + w(4)*(ca.*cb.*cc)./(16.5*34e11))./....
    (ka + ca + (cb.*ka)./16.5 + (cc.*ka)./34e11 + (w(1)*ca.*cb)./16.5 + w(2)*(cb.*cc.*ka)./(16.5*34e11) + w(3)*(ca.*cc)./34e11 + w(4)*(ca.*cb.*cc)./(16.5*34e11)));
% dl1,twi - dl2 deletion
q = @(w,ka,ca,cb,cc)((ca + (cb.*ka)/52e11 + (cc.*ka)./34 + (w(1)*ca.*cb)./52e11 + w(2)*(cb.*cc.*ka)./(52e11*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cb.*cc)./(52e11*34))./....
    (ka + ca + (cb.*ka)./52e11 + (cc.*ka)./34 + (w(1)*ca.*cb)./52e11 + w(2)*(cb.*cc.*ka)./(52e11*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cb.*cc)./(52e11*34)));
% twi - dl1/2 deletion
r = @(w,ca,cb,cc)((ca + (cb.*10e11)/52e11 + (cc.*10e11)./34 + (w(1)*ca.*cb)./52e11 + w(2)*(cb.*cc.*10e11)./(52e11*34) + w(3)*(ca.*cc)./34 + (ca.*cb.*cc)./(52e11*34))./....
    (10e11 + ca + (cb.*10e11)./52e11 + (cc.*10e11)./34 + (w(1)*ca.*cb)./52e11 + w(2)*(cb.*cc.*10e11)./(52e11*34) + w(3)*(ca.*cc)./34 + (ca.*cb.*cc)./(52e11*34)));
% dl2,twi - dl1 del -- no signal
s = @(w,ca,cb,cc)((ca + (cb.*10e11)/16.5 + (cc.*10e11)./34 + (w(1)*ca.*cb)./16.5 + w(2)*(cb.*cc.*10e11)./(16.5*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cb.*cc)./(16.5*34))./....
    (10e11 + ca + (cb.*10e11)./16.5 + (cc.*10e11)./34 + (w(1)*ca.*cb)./16.5 + w(2)*(cb.*cc.*10e11)./(16.5*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cb.*cc)./(16.5*34)));

ka = 10;
kb = 52; 
kc = 34; 
% kb = 16.5; %dl3
f = @(w,ka,kb,kc,ca,cb,cc)((ca + (cb.*ka)/kb + (cc.*ka)./kc + (w(1)*ca.*cb)./kb + w(2)*(cb.*cc.*ka)./(kb*kc) + w(3)*(ca.*cc)./kc + w(4)*(ca.*cb.*cc)./(kb*kc))./....
    (ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (w(1)*ca.*cb)./kb + w(2)*(cb.*cc.*ka)./(kb*kc) + w(3)*(ca.*cc)./kc + w(4)*(ca.*cb.*cc)./(kb*kc)));
obj = @(w) sum(sqrt((f(w,ka,kb,kc,ca,cb,cc)-2.86*m(w,ka,ca,cb,cc)).^2) + sqrt((f(w,ka,kb,kc,ca,cb,cc)-2.86*p(w,ka,ca,cb,cc)).^2)...
    + sqrt((f(w,ka,kb,kc,ca,cb,cc)-2.86*q(w,ka,ca,cb,cc)).^2) + sqrt((f(w,ka,kb,kc,ca,cb,cc)-2.86*r(w,ca,cb,cc)).^2) ...
    + sqrt((f(w,ka,kb,kc,ca,cb,cc)-10*s(w,ca,cb,cc)).^2));
w_guess=[1,1,1,1];
lb = ones(1,100);
w = fmincon(obj,w_guess, [],[],[],[], lb)

w1 = w(1); w2 = w(2); w3 = w(3); w4 = w(4); 
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (w1*ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cb.*cc)./(kb*kc);
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (w1*ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cb.*cc)./(kb*kc);
p = num./den; 
kc = 34e11; ka = 10; kb = 52; %twi del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (w1*ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cb.*cc)./(kb*kc);
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (w1*ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cb.*cc)./(kb*kc);
p1 = num./den;
kc = 34e11; kb = 52e11; ka = 10; %dl3,twi del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (w1*ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cb.*cc)./(kb*kc);
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (w1*ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cb.*cc)./(kb*kc);
p2 = num./den; 
kc = 34; kb = 52; ka = 10e11; %dl1 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (w1*ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cb.*cc)./(kb*kc);
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (w1*ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cb.*cc)./(kb*kc);
p3 = num./den; 
kc = 34; kb = 52e11; ka = 10e11; %dl1/2 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (w1*ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cb.*cc)./(kb*kc);
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (w1*ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cb.*cc)./(kb*kc);
p4 = num./den; 
plot(x,p); hold on; hold on; plot(x,p1); hold on; plot(x,p2); hold on; plot(x,p3); hold on; plot(x,p4);
title('Optimizing cooperativity'); legend('All three sites','Twi del','Dl3,Twi del','Dl1 del','Dl1/2 del');

%% 4 sites - use cooperativity as parameter in objective function
% Generic curves
load('G:\Shared drives\Lim_Lab\Sahla\snail enhancer\Imaging\snaSEmin binding site mutations/Dl_Twi');
x = 0:0.01:0.99;
ca = 400*normpdf(x,0.5,0.08)./2000;
cb = 400*normpdf(x,0.5,0.08)./2000;
cd = 400*normpdf(x,0.5,0.08)./2000;
c_twi = smooth(mean(Dl(1:8,:),1)); % smooth curve
cc = [c_twi/max(c_twi)]'; % normalize using smooth curve

ka = 10; % dl1 binding
kb = 52; % dl2 binding 
kc = 34; % twi binding
kd = 16.5; % dl3 binding
% kz = 1/8.1e-4; % zld binding

% dl1/2 - dl3,twi deletion
m = @(w,ca,cb,cc,cd)((ca + (cb.*10)./52 + (cc.*10)./34e11 + (cd.*10)./16.5e11 + w(1)*(ca.*cb)./52 + w(2)*(cb.*cc.*10)./(52*34e11) + w(3)*(ca.*cc)./34e11 + w(4)*(ca.*cd)./16.5e11 +....
    w(5)*(cb.*cd.*10)./(52*16.5e11) + w(6)*(cc.*cd.*10)./(34e11*16.5e11) + w(7)*(ca.*cb.*cc)./(52*34e11) + w(8)*(ca.*cc.*cd)./(34e11*16.5e11) + ...
    w(9)*(cb.*cc.*cd.*10)./(52*34e11*16.5e11) +  w(10)*(ca.*cc.*cd)./(34e11*16.5e11) + w(11)*(ca.*cb.*cc.*cd)./(52*34e11*16.5e11))./...
    (10 + ca + (cb.*10)./52 + (cc.*10)./34e11 + (cd.*10)./16.5e11 + w(1)*(ca.*cb)./52 + w(2)*(cb.*cc.*10)./(52*34e11) + w(3)*(ca.*cc)./34e11 + w(4)*(ca.*cd)./16.5e11 +....
    w(5)*(cb.*cd.*10)./(52*16.5e11) + w(6)*(cc.*cd.*10)./(34e11*16.5e11) + w(7)*(ca.*cb.*cc)./(52*34e11) + w(8)*(ca.*cc.*cd)./(34e11*16.5e11) + ...
    w(9)*(cb.*cc.*cd.*10)./(52*34e11*16.5e11) +  w(10)*(ca.*cc.*cd)./(34e11*16.5e11) + w(11)*(ca.*cb.*cc.*cd)./(52*34e11*16.5e11)));
% dl1/2/3 - twi deletion
p = @(w,ca,cb,cc,cd)((ca + (cb.*10)./52 + (cc.*10)./34e11 + (cd.*10)./16.5 + w(1)*(ca.*cb)./52 + w(2)*(cb.*cc.*10)./(52*34e11) + w(3)*(ca.*cc)./34e11 + w(4)*(ca.*cd)./16.5 +....
    w(5)*(cb.*cd.*10)./(52*16.5) + w(6)*(cc.*cd.*10)./(34e11*16.5) + w(7)*(ca.*cb.*cc)./(52*34e11) + w(8)*(ca.*cc.*cd)./(34e11*16.5) + ...
    w(9)*(cb.*cc.*cd.*10)./(52*34e11*16.5) +  w(10)*(ca.*cc.*cd)./(34e11*16.5) + w(11)*(ca.*cb.*cc.*cd)./(52*34e11*16.5))./...
    (10 + ca + (cb.*10)./52 + (cc.*10)./34e11 + (cd.*10)./16.5 + w(1)*(ca.*cb)./52 + w(2)*(cb.*cc.*10)./(52*34e11) + w(3)*(ca.*cc)./34e11 + w(4)*(ca.*cd)./16.5 +....
    w(5)*(cb.*cd.*10)./(52*16.5) + w(6)*(cc.*cd.*10)./(34e11*16.5) + w(7)*(ca.*cb.*cc)./(52*34e11) + w(8)*(ca.*cc.*cd)./(34e11*16.5) + ...
    w(9)*(cb.*cc.*cd.*10)./(52*34e11*16.5) +  w(10)*(ca.*cc.*cd)./(34e11*16.5) + w(11)*(ca.*cb.*cc.*cd)./(52*34e11*16.5)));
% d1/2,twi - dl3 deletion 
q = @(w,ca,cb,cc,cd)((ca + (cb.*10)./52 + (cc.*10)./34 + (cd.*10)./16.5e11 + (w(1)*ca.*cb)./52 + w(2)*(cb.*cc.*10)./(52*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cd)./16.5e11 +....
    w(5)*(cb.*cd.*10)./(52*16.5e11) + w(6)*(cc.*cd.*10)./(34*16.5e11) + w(7)*(ca.*cb.*cc)./(52*34) + w(8)*(ca.*cc.*cd)./(34*16.5e11) + ...
    w(9)*(cb.*cc.*cd.*10)./(52*34*16.5e11) +  w(10)*(ca.*cc.*cd)./(34*16.5e11) + w(11)*(ca.*cb.*cc.*cd)./(52*34*16.5e11))./...
    (10 + ca + (cb.*10)./52 + (cc.*10)./34 + (cd.*10)./16.5e11 + w(1)*(ca.*cb)./52 + w(2)*(cb.*cc.*10)./(52*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cd)./16.5e11 +....
    w(5)*(cb.*cd.*10)./(52*16.5e11) + w(6)*(cc.*cd.*10)./(34*16.5e11) + w(7)*(ca.*cb.*cc)./(52*34) + w(8)*(ca.*cc.*cd)./(34*16.5e11) + ...
    w(9)*(cb.*cc.*cd.*10)./(52*34*16.5e11) +  w(10)*(ca.*cc.*cd)./(34*16.5e11) + w(11)*(ca.*cb.*cc.*cd)./(52*34*16.5e11)));
%dl1/3,twi - dl2 deletion
r = @(w,ca,cb,cc,cd)((ca + (cb.*10)./52e11 + (cc.*10)./34 + (cd.*10)./16.5 + (w(1)*ca.*cb)./52e11 + w(2)*(cb.*cc.*10)./(52e11*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cd)./16.5 +....
    w(5)*(cb.*cd.*10)./(52e11*16.5) + w(6)*(cc.*cd.*10)./(34*16.5) + w(7)*(ca.*cb.*cc)./(52e11*34) + w(8)*(ca.*cc.*cd)./(34*16.5) + ...
    w(9)*(cb.*cc.*cd.*10)./(52e11*34*16.5) +  w(10)*(ca.*cc.*cd)./(34*16.5) + w(11)*(ca.*cb.*cc.*cd)./(52e11*34*16.5))./...
    (10 + ca + (cb.*10)./52e11 + (cc.*10)./34 + (cd.*10)./16.5 + w(1)*(ca.*cb)./52e11 + w(2)*(cb.*cc.*10)./(52e11*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cd)./16.5 +....
    w(5)*(cb.*cd.*10)./(52e11*16.5) + w(6)*(cc.*cd.*10)./(34*16.5) + w(7)*(ca.*cb.*cc)./(52e11*34) + w(8)*(ca.*cc.*cd)./(34*16.5) + ...
    w(9)*(cb.*cc.*cd.*10)./(52e11*34*16.5) +  w(10)*(ca.*cc.*cd)./(34*16.5) + w(11)*(ca.*cb.*cc.*cd)./(52e11*34*16.5)));
% dl2/3,twi - dl1 del 
s = @(w,ca,cb,cc,cd)((ca + (cb.*10e11)./52 + (cc.*10e11)./34 + (cd.*10e11)./16.5 + (w(1)*ca.*cb)./52 + w(2)*(cb.*cc.*10e11)./(52*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cd)./16.5 +....
    w(5)*(cb.*cd.*10e11)./(52*16.5) + w(6)*(cc.*cd.*10e11)./(34*16.5) + w(7)*(ca.*cb.*cc)./(52*34) + w(8)*(ca.*cc.*cd)./(34*16.5) + ...
    w(9)*(cb.*cc.*cd.*10e11)./(52*34*16.5) +  w(10)*(ca.*cc.*cd)./(34*16.5) + w(11)*(ca.*cb.*cc.*cd)./(52*34*16.5))./...
    (10e11 + ca + (cb.*10e11)./52 + (cc.*10e11)./34 + (cd.*10e11)./16.5 + (w(1)*ca.*cb)./52 + w(2)*(cb.*cc.*10e11)./(52*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cd)./16.5 +....
    w(5)*(cb.*cd.*10e11)./(52*16.5) + w(6)*(cc.*cd.*10e11)./(34*16.5) + w(7)*(ca.*cb.*cc)./(52*34) + w(8)*(ca.*cc.*cd)./(34*16.5) + ...
    w(9)*(cb.*cc.*cd.*10e11)./(52*34*16.5) +  w(10)*(ca.*cc.*cd)./(34*16.5) + w(11)*(ca.*cb.*cc.*cd)./(52*34*16.5)));
% dl3,twi - dl1/2 del
t = @(w,ca,cb,cc,cd)((ca + (cb.*10e11)./52e11 + (cc.*10e11)./34 + (cd.*10e11)./16.5 + (w(1)*ca.*cb)./52e11 + w(2)*(cb.*cc.*10e11)./(52e11*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cd)./16.5 +....
    w(5)*(cb.*cd.*10e11)./(52e11*16.5) + w(6)*(cc.*cd.*10e11)./(34*16.5) + w(7)*(ca.*cb.*cc)./(52e11*34) + w(8)*(ca.*cc.*cd)./(34*16.5) + ...
    w(9)*(cb.*cc.*cd.*10e11)./(52e11*34*16.5) +  w(10)*(ca.*cc.*cd)./(34*16.5) +  w(11)*(ca.*cb.*cc.*cd)./(52e11*34*16.5))./...
    (10e11 + ca + (cb.*10e11)./52e11 + (cc.*10e11)./34 + (cd.*10e11)./16.5 + (w(1)*ca.*cb)./52e11 + w(2)*(cb.*cc.*10e11)./(52e11*34) + w(3)*(ca.*cc)./34 + w(4)*(ca.*cd)./16.5 +....
    w(5)*(cb.*cd.*10e11)./(52e11*16.5) + w(6)*(cc.*cd.*10e11)./(34*16.5) + w(7)*(ca.*cb.*cc)./(52e11*34) + w(8)*(ca.*cc.*cd)./(34*16.5) + ...
    w(9)*(cb.*cc.*cd.*10e11)./(52e11*34*16.5) +  w(10)*(ca.*cc.*cd)./(34*16.5) +  w(11)*(ca.*cb.*cc.*cd)./(52e11*34*16.5)));

ka = 10;
kb = 52; 
kc = 34; 
kd = 16.5;
f = @(w,ka,kb,kc,kd,ca,cb,cc,cd)((ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w(1)*(ca.*cb)./kb + w(2)*(cb.*cc.*ka)./(kb*kc) + w(3)*(ca.*cc)./kc + w(4)*(ca.*cd)./kd +....
    w(5)*(cb.*cd.*ka)./(kb*kd) + w(6)*(cc.*cd.*ka)./(kc*kd) + w(7)*(ca.*cb.*cc)./(kb*kc) + w(8)*(ca.*cc.*cd)./(kc*kd) + ...
    w(9)*(cb.*cc.*cd.*ka)./(kb*kc*kd) +  w(10)*(ca.*cc.*cd)./(kc*kd) +  w(11)*(ca.*cb.*cc.*cd)./(kb*kc*kd))./...
    (ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w(1)*(ca.*cb)./kb + w(2)*(cb.*cc.*ka)./(kb*kc) + w(3)*(ca.*cc)./kc + w(4)*(ca.*cd)./kd +....
    w(5)*(cb.*cd.*ka)./(kb*kd) + w(6)*(cc.*cd.*ka)./(kc*kd) + w(7)*(ca.*cb.*cc)./(kb*kc) + w(8)*(ca.*cc.*cd)./(kc*kd) + ...
    w(9)*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w(10)*(ca.*cc.*cd)./(kc*kd) +  w(11)*(ca.*cb.*cc.*cd)./(kb*kc*kd)));
obj = @(w) sum(sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*m(w,ca,cb,cc,cd)).^2) + sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*p(w,ca,cb,cc,cd)).^2) +...
    sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*q(w,ca,cb,cc,cd)).^2) + sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*r(w,ca,cb,cc,cd)).^2) + ...
    + sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*s(w,ca,cb,cc,cd)).^2) + sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*t(w,ca,cb,cc,cd)).^2));
w_guess=ones(1,11);
lb = ones(1,100);
w = fmincon(obj,w_guess,[],[],[],[],lb)

% w1 = w(1); w2 = w(2); w3 = w(3); w4 = w(4); w5 = w(5); w6 = w(6); w7 = w(7); w8 = w(8); w9 = w(9); w10 = w(10); w11 = w(11);
w1 = 1; w2 = 1; w3 = 1; w4 = 1; w5 = 1; w6 = 1; w7 = 1; w8 = 1; w9 = 1 ; w10 = 1; w11 = 1;

num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) +  w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) +  w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd);  
p = num./den; 
ka = 10; kb = 52; kc = 34e11; kd = 16.5; %twi del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p1 = num./den;
ka = 10; kb = 52; kc = 34e11; kd = 16.5e11; %dl3,twi del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p2 = num./den; 
ka = 10; kb = 52; kc = 34; kd = 16.5e11; %dl3 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p3 = num./den; 
ka = 10; kb = 52e11; kc = 34; kd = 16.5; %dl2 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p4 = num./den;
ka = 10e11; kb = 52; kc = 34; kd = 16.5; %dl1 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p5 = num./den;
ka = 10e11; kb = 52e11; kc = 34; kd = 16.5; %dl1/2 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p6 = num./den;
plot(x,p); hold on; hold on; plot(x,p1); hold on; plot(x,p2); hold on; plot(x,p3); hold on; plot(x,p4); hold on; plot(x,p5); hold on; plot(x,p6);
title('Optimizing cooperativity'); legend('All four sites','Twi del','Dl3,Twi del','Dl3 del','Dl2 del','Dl1 del','Dl1/2 del');

%% 4 sites - use cooperativity as parameter in objective function - only 3 w
% Generic curves
load('G:\Shared drives\Lim_Lab\Sahla\snail enhancer\Imaging\snaSEmin binding site mutations/Dl_Twi');
x = 0:0.01:0.99;
ca = 400*normpdf(x,0.5,0.08)./2000; 
cb = 400*normpdf(x,0.5,0.08)./2000;
cd = 400*normpdf(x,0.5,0.08)./2000;
c_twi = smooth(mean(Dl(1:8,:),1)); % smooth curve
cc = [c_twi/max(c_twi)]'; % normalize using smooth curve

ka = 10; % dl1 binding
kb = 52; % dl2 binding 
kc = 34; % twi binding
kd = 16.5; % dl3 binding
% kz = 1/8.1e-4; % zld binding

% dl1/2 - dl3,twi deletion
m = @(w,ca,cb,cc,cd)((ca + (cb.*10)./52 + (cc.*10)./34e11 + (cd.*10)./16.5e11 + (ca.*cb)./52 + (cb.*cc.*10)./(52*34e11) + (ca.*cc)./34e11 + (ca.*cd)./16.5e11 +....
    (cb.*cd.*10)./(52*16.5e11) + (cc.*cd.*10)./(34e11*16.5e11) + w(1)*(ca.*cb.*cc)./(52*34e11) + (ca.*cc.*cd)./(34e11*16.5e11) + ...
    w(2)*(cb.*cc.*cd.*10)./(52*34e11*16.5e11) + (ca.*cc.*cd)./(34e11*16.5e11) + w(3)*(ca.*cb.*cc.*cd)./(52*34e11*16.5e11))./...
    (10 + ca + (cb.*10)./52 + (cc.*10)./34e11 + (cd.*10)./16.5e11 + (ca.*cb)./52 + (cb.*cc.*10)./(52*34e11) + (ca.*cc)./34e11 + (ca.*cd)./16.5e11 +....
    (cb.*cd.*10)./(52*16.5e11) + (cc.*cd.*10)./(34e11*16.5e11) + w(1)*(ca.*cb.*cc)./(52*34e11) + (ca.*cc.*cd)./(34e11*16.5e11) + ...
    w(2)*(cb.*cc.*cd.*10)./(52*34e11*16.5e11) + (ca.*cc.*cd)./(34e11*16.5e11) + w(3)*(ca.*cb.*cc.*cd)./(52*34e11*16.5e11)));
% dl1/2/3 - twi deletion
p = @(w,ca,cb,cc,cd)((ca + (cb.*10)./52 + (cc.*10)./34e11 + (cd.*10)./16.5 + (ca.*cb)./52 + (cb.*cc.*10)./(52*34e11) + (ca.*cc)./34e11 + (ca.*cd)./16.5 +....
    (cb.*cd.*10)./(52*16.5) + (cc.*cd.*10)./(34e11*16.5) + w(1)*(ca.*cb.*cc)./(52*34e11) + (ca.*cc.*cd)./(34e11*16.5) + ...
    w(2)*(cb.*cc.*cd.*10)./(52*34e11*16.5) + (ca.*cc.*cd)./(34e11*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52*34e11*16.5))./...
    (10 + ca + (cb.*10)./52 + (cc.*10)./34e11 + (cd.*10)./16.5 + (ca.*cb)./52 + (cb.*cc.*10)./(52*34e11) + (ca.*cc)./34e11 + (ca.*cd)./16.5 +....
    (cb.*cd.*10)./(52*16.5) + (cc.*cd.*10)./(34e11*16.5) + w(1)*(ca.*cb.*cc)./(52*34e11) + (ca.*cc.*cd)./(34e11*16.5) + ...
    w(2)*(cb.*cc.*cd.*10)./(52*34e11*16.5) + (ca.*cc.*cd)./(34e11*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52*34e11*16.5)));
% d1/2,twi - dl3 deletion 
q = @(w,ca,cb,cc,cd)((ca + (cb.*10)./52 + (cc.*10)./34 + (cd.*10)./16.5e11 + (ca.*cb)./52 + (cb.*cc.*10)./(52*34) + (ca.*cc)./34 + (ca.*cd)./16.5e11 +....
    (cb.*cd.*10)./(52*16.5e11) + (cc.*cd.*10)./(34*16.5e11) + w(1)*(ca.*cb.*cc)./(52*34) + (ca.*cc.*cd)./(34*16.5e11) + ...
    w(2)*(cb.*cc.*cd.*10)./(52*34*16.5e11) + (ca.*cc.*cd)./(34*16.5e11) + w(3)*(ca.*cb.*cc.*cd)./(52*34*16.5e11))./...
    (10 + ca + (cb.*10)./52 + (cc.*10)./34 + (cd.*10)./16.5e11 + (ca.*cb)./52 + (cb.*cc.*10)./(52*34) + (ca.*cc)./34 + (ca.*cd)./16.5e11 +....
    (cb.*cd.*10)./(52*16.5e11) + (cc.*cd.*10)./(34*16.5e11) + w(1)*(ca.*cb.*cc)./(52*34) + (ca.*cc.*cd)./(34*16.5e11) + ...
    w(2)*(cb.*cc.*cd.*10)./(52*34*16.5e11) +  (ca.*cc.*cd)./(34*16.5e11) + w(3)*(ca.*cb.*cc.*cd)./(52*34*16.5e11)));
%dl1/3,twi - dl2 deletion
r = @(w,ca,cb,cc,cd)((ca + (cb.*10)./52e11 + (cc.*10)./34 + (cd.*10)./16.5 + (ca.*cb)./52e11 + (cb.*cc.*10)./(52e11*34) + (ca.*cc)./34 + (ca.*cd)./16.5 +....
    (cb.*cd.*10)./(52e11*16.5) + (cc.*cd.*10)./(34*16.5) + w(1)*(ca.*cb.*cc)./(52e11*34) + (ca.*cc.*cd)./(34*16.5) + ...
    w(2)*(cb.*cc.*cd.*10)./(52e11*34*16.5) + (ca.*cc.*cd)./(34*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52e11*34*16.5))./...
    (10 + ca + (cb.*10)./52e11 + (cc.*10)./34 + (cd.*10)./16.5 + (ca.*cb)./52e11 + (cb.*cc.*10)./(52e11*34) + (ca.*cc)./34 + (ca.*cd)./16.5 +....
    (cb.*cd.*10)./(52e11*16.5) + (cc.*cd.*10)./(34*16.5) + w(1)*(ca.*cb.*cc)./(52e11*34) + (ca.*cc.*cd)./(34*16.5) + ...
    w(2)*(cb.*cc.*cd.*10)./(52e11*34*16.5) + (ca.*cc.*cd)./(34*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52e11*34*16.5)));
% dl2/3,twi - dl1 del 
s = @(w,ca,cb,cc,cd)((ca + (cb.*10e11)./52 + (cc.*10e11)./34 + (cd.*10e11)./16.5 + (ca.*cb)./52 + (cb.*cc.*10e11)./(52*34) + (ca.*cc)./34 + (ca.*cd)./16.5 +....
    (cb.*cd.*10e11)./(52*16.5) + (cc.*cd.*10e11)./(34*16.5) + w(1)*(ca.*cb.*cc)./(52*34) + (ca.*cc.*cd)./(34*16.5) + ...
    w(2)*(cb.*cc.*cd.*10e11)./(52*34*16.5) +  (ca.*cc.*cd)./(34*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52*34*16.5))./...
    (10e11 + ca + (cb.*10e11)./52 + (cc.*10e11)./34 + (cd.*10e11)./16.5 + (ca.*cb)./52 + (cb.*cc.*10e11)./(52*34) + (ca.*cc)./34 + (ca.*cd)./16.5 +....
    (cb.*cd.*10e11)./(52*16.5) + (cc.*cd.*10e11)./(34*16.5) + w(1)*(ca.*cb.*cc)./(52*34) + (ca.*cc.*cd)./(34*16.5) + ...
    w(2)*(cb.*cc.*cd.*10e11)./(52*34*16.5) + (ca.*cc.*cd)./(34*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52*34*16.5)));
% dl3,twi - dl1/2 del
t = @(w,ca,cb,cc,cd)((ca + (cb.*10e11)./52e11 + (cc.*10e11)./34 + (cd.*10e11)./16.5 + (ca.*cb)./52e11 + (cb.*cc.*10e11)./(52e11*34) + (ca.*cc)./34 + (ca.*cd)./16.5 +....
    (cb.*cd.*10e11)./(52e11*16.5) + (cc.*cd.*10e11)./(34*16.5) + w(1)*(ca.*cb.*cc)./(52e11*34) + (ca.*cc.*cd)./(34*16.5) + ...
    w(2)*(cb.*cc.*cd.*10e11)./(52e11*34*16.5) + (ca.*cc.*cd)./(34*16.5) +  w(3)*(ca.*cb.*cc.*cd)./(52e11*34*16.5))./...
    (10e11 + ca + (cb.*10e11)./52e11 + (cc.*10e11)./34 + (cd.*10e11)./16.5 + (ca.*cb)./52e11 + (cb.*cc.*10e11)./(52e11*34) + (ca.*cc)./34 + (ca.*cd)./16.5 +....
    (cb.*cd.*10e11)./(52e11*16.5) +(cc.*cd.*10e11)./(34*16.5) + w(1)*(ca.*cb.*cc)./(52e11*34) + (ca.*cc.*cd)./(34*16.5) + ...
    w(2)*(cb.*cc.*cd.*10e11)./(52e11*34*16.5) +  (ca.*cc.*cd)./(34*16.5) +  w(3)*(ca.*cb.*cc.*cd)./(52e11*34*16.5)));

ka = 10;
kb = 52; 
kc = 34; 
kd = 16.5;
f = @(w,ka,kb,kc,kd,ca,cb,cc,cd)((ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) +(ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + w(1)*(ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    w(2)*(cb.*cc.*cd.*ka)./(kb*kc*kd) + (ca.*cc.*cd)./(kc*kd) +  w(3)*(ca.*cb.*cc.*cd)./(kb*kc*kd))./...
    (ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + w(1)*(ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    w(2)*(cb.*cc.*cd.*ka)./(kb*kc*kd) + (ca.*cc.*cd)./(kc*kd) +  w(3)*(ca.*cb.*cc.*cd)./(kb*kc*kd)));
obj = @(w) sum(sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*m(w,ca,cb,cc,cd)).^2) + sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*p(w,ca,cb,cc,cd)).^2) +...
    sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*q(w,ca,cb,cc,cd)).^2) + sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*r(w,ca,cb,cc,cd)).^2) + ...
    + sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*s(w,ca,cb,cc,cd)).^2) + sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*t(w,ca,cb,cc,cd)).^2))/6;
w_guess=ones(1,3);
lb = ones(1,100);
w = fmincon(obj,w_guess,[],[],[],[],lb)

% w1 = w(1); w2 = w(2); w3 = w(3); w4 = w(4); w5 = w(5); w6 = w(6); w7 = w(7); w8 = w(8); w9 = w(9); w10 = w(10); w11 = w(11);
w1 = 1; w2 = 1; w3 = 1; w4 = 1; w5 = 1; w6 = 1; w7 = w(1); w8 = 1; w9 = w(2); w10 = 1; w11 = w(3);

num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) +  w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) +  w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd);  
p = num./den; 
ka = 10; kb = 52; kc = 34e11; kd = 16.5; %twi del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p1 = num./den;
ka = 10; kb = 52; kc = 34e11; kd = 16.5e11; %dl3,twi del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p2 = num./den; 
ka = 10; kb = 52; kc = 34; kd = 16.5e11; %dl3 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p3 = num./den; 
ka = 10; kb = 52e11; kc = 34; kd = 16.5; %dl2 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p4 = num./den;
ka = 10e11; kb = 52; kc = 34; kd = 16.5; %dl1 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p5 = num./den;
ka = 10e11; kb = 52e11; kc = 34; kd = 16.5; %dl1/2 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p6 = num./den;
plot(x,p); hold on; hold on; plot(x,p1); hold on; plot(x,p2); hold on; plot(x,p3); hold on; plot(x,p4); hold on; plot(x,p5); hold on; plot(x,p6);
title('Optimizing cooperativity'); legend('All four sites','Twi del','Dl3,Twi del','Dl3 del','Dl2 del','Dl1 del','Dl1/2 del');

%% 4 sites - use binding affinities as parameter in objective funciton
% Generic curves
load('G:\Shared drives\Lim_Lab\Sahla\snail enhancer\Imaging\snaSEmin binding site mutations/Dl_Twi');
x = 0:0.01:0.99;
ca = 400*normpdf(x,0.5,0.08)./1000;
cb = 400*normpdf(x,0.5,0.08)./1000;
cd = 400*normpdf(x,0.5,0.08)./1000;
c_twi = smooth(mean(Dl(1:8,:),1)); % smooth curve
cc = [c_twi/max(c_twi)]'; % normalize using smooth curve

% dl1/2 - dl3,twi deletion
m = @(k,ca,cb,cc,cd)((ca + (cb.*k(1))./k(2) + (cc.*k(1))./34e11 + (cd.*k(1))./16.5e11 + (ca.*cb)./k(2) + (cb.*cc.*k(1))./(k(2)*34e11) + (ca.*cc)./34e11 +(ca.*cd)./16.5e11 +....
    (cb.*cd.*k(1))./(k(2)*16.5e11) + (cc.*cd.*k(1))./(34e11*16.5e11) + (ca.*cb.*cc)./(k(2)*34e11) + (ca.*cc.*cd)./(34e11*16.5e11) + ...
    (cb.*cc.*cd.*k(1))./(k(2)*34e11*16.5e11) + (ca.*cc.*cd)./(34e11*16.5e11) + (ca.*cb.*cc.*cd)./(k(2)*34e11*16.5e11))./...
    (k(1) + ca + (cb.*k(1))./k(2) + (cc.*k(1))./34e11 + (cd.*k(1))./16.5e11 + (ca.*cb)./k(2) + (cb.*cc.*k(1))./(k(2)*34e11) + (ca.*cc)./34e11 + (ca.*cd)./16.5e11 +....
    (cb.*cd.*k(1))./(k(2)*16.5e11) + (cc.*cd.*k(1))./(34e11*16.5e11) + (ca.*cb.*cc)./(k(2)*34e11) + (ca.*cc.*cd)./(34e11*16.5e11) + ...
    (cb.*cc.*cd.*k(1))./(k(2)*34e11*16.5e11) + (ca.*cc.*cd)./(34e11*16.5e11) + (ca.*cb.*cc.*cd)./(k(2)*34e11*16.5e11)));
% dl1/2/3 - twi deletion
p = @(k,ca,cb,cc,cd)((ca + (cb.*k(1))./k(2) + (cc.*k(1))./34e11 + (cd.*k(1))./k(4) + (ca.*cb)./k(2) + (cb.*cc.*k(1))./(k(2)*34e11) + (ca.*cc)./34e11 + (ca.*cd)./k(4) +....
    (cb.*cd.*k(1))./(k(2)*k(4)) + (cc.*cd.*k(1))./(34e11*k(4)) + (ca.*cb.*cc)./(k(2)*34e11) + (ca.*cc.*cd)./(34e11*k(4)) + ...
    (cb.*cc.*cd.*k(1))./(k(2)*34e11*k(4)) +  (ca.*cc.*cd)./(34e11*k(4)) + (ca.*cb.*cc.*cd)./(k(2)*34e11*k(4)))./...
    (k(1) + ca + (cb.*k(1))./k(2) + (cc.*k(1))./34e11 + (cd.*k(1))./k(4) + (ca.*cb)./k(2) + (cb.*cc.*k(1))./(k(2)*34e11) + (ca.*cc)./34e11 + (ca.*cd)./k(4) +....
    (cb.*cd.*k(1))./(k(2)*k(4)) + (cc.*cd.*k(1))./(34e11*k(4)) + (ca.*cb.*cc)./(k(2)*34e11) + (ca.*cc.*cd)./(34e11*k(4)) + ...
    (cb.*cc.*cd.*k(1))./(k(2)*34e11*k(4)) +  (ca.*cc.*cd)./(34e11*k(4)) + (ca.*cb.*cc.*cd)./(k(2)*34e11*k(4))));
% d1/2,twi - dl3 deletion 
q = @(k,ca,cb,cc,cd)((ca + (cb.*k(1))./k(2) + (cc.*k(1))./k(3) + (cd.*k(1))./16.5e11 + (ca.*cb)./k(2) + (cb.*cc.*k(1))./(k(2)*k(3)) +(ca.*cc)./k(3) + (ca.*cd)./16.5e11 +....
    (cb.*cd.*k(1))./(k(2)*16.5e11) + (cc.*cd.*k(1))./(k(3)*16.5e11) + (ca.*cb.*cc)./(k(2)*k(3)) + (ca.*cc.*cd)./(k(3)*16.5e11) + ...
    (cb.*cc.*cd.*k(1))./(k(2)*k(3)*16.5e11) +  (ca.*cc.*cd)./(k(3)*16.5e11) + (ca.*cb.*cc.*cd)./(k(2)*k(3)*16.5e11))./...
    (k(1) + ca + (cb.*k(1))./k(2) + (cc.*k(1))./k(3) + (cd.*k(1))./16.5e11 + (ca.*cb)./k(2) + (cb.*cc.*k(1))./(k(2)*k(3)) +(ca.*cc)./k(3) + (ca.*cd)./16.5e11 +....
    (cb.*cd.*k(1))./(k(2)*16.5e11) + (cc.*cd.*k(1))./(k(3)*16.5e11) + (ca.*cb.*cc)./(k(2)*k(3)) + (ca.*cc.*cd)./(k(3)*16.5e11) + ...
    (cb.*cc.*cd.*k(1))./(k(2)*k(3)*16.5e11) +  (ca.*cc.*cd)./(k(3)*16.5e11) + (ca.*cb.*cc.*cd)./(k(2)*k(3)*16.5e11)));
%dl1/3,twi - dl2 deletion
r = @(k,ca,cb,cc,cd)((ca + (cb.*k(1))./52e11 + (cc.*k(1))./k(3) + (cd.*k(1))./k(4) + ca.*cb)./52e11 + (cb.*cc.*k(1))./(52e11*k(3)) + (ca.*cc)./k(3) + (ca.*cd)./k(4) +....
    (cb.*cd.*k(1))./(52e11*k(4)) + (cc.*cd.*k(1))./(k(3)*k(4)) + (ca.*cb.*cc)./(52e11*k(3)) + (ca.*cc.*cd)./(k(3)*k(4)) + ...
    (cb.*cc.*cd.*k(1))./(52e11*k(3)*k(4)) +  (ca.*cc.*cd)./(k(3)*k(4)) + (ca.*cb.*cc.*cd)./(52e11*k(3)*k(4))./...
    (k(1) + ca + (cb.*k(1))./52e11 + (cc.*k(1))./k(3) + (cd.*k(1))./k(4) + ca.*cb)./52e11 + (cb.*cc.*k(1))./(52e11*k(3)) + (ca.*cc)./k(3) + (ca.*cd)./k(4) +....
    (cb.*cd.*k(1))./(52e11*k(4)) + (cc.*cd.*k(1))./(k(3)*k(4)) + (ca.*cb.*cc)./(52e11*k(3)) + (ca.*cc.*cd)./(k(3)*k(4)) + ...
    (cb.*cc.*cd.*k(1))./(52e11*k(3)*k(4)) +  (ca.*cc.*cd)./(k(3)*k(4)) + (ca.*cb.*cc.*cd)./(52e11*k(3)*k(4)));
% dl2/3,twi - dl1 del -- no signal
s = @(k,ca,cb,cc,cd)((ca + (cb.*10e11)./k(2) + (cc.*10e11)./k(3) + (cd.*10e11)./k(4) + (ca.*cb)./k(2) + (cb.*cc.*10e11)./(k(2)*k(3)) + (ca.*cc)./k(3) + (ca.*cd)./k(4) +....
    (cb.*cd.*10e11)./(k(2)*k(4)) + (cc.*cd.*10e11)./(k(3)*k(4)) + (ca.*cb.*cc)./(k(2)*k(3)) + (ca.*cc.*cd)./(k(3)*k(4)) + ...
    (cb.*cc.*cd.*10e11)./(k(2)*k(3)*k(4)) + (ca.*cc.*cd)./(k(3)*k(4)) + (ca.*cb.*cc.*cd)./(k(2)*k(3)*k(4)))./...
    (10e11 + ca + (cb.*10e11)./k(2) + (cc.*10e11)./k(3) + (cd.*10e11)./k(4) + (ca.*cb)./k(2) + (cb.*cc.*10e11)./(k(2)*k(3)) + (ca.*cc)./k(3) + (ca.*cd)./k(4) +....
    (cb.*cd.*10e11)./(k(2)*k(4)) + (cc.*cd.*10e11)./(k(3)*k(4)) + (ca.*cb.*cc)./(k(2)*k(3)) + (ca.*cc.*cd)./(k(3)*k(4)) + ...
    (cb.*cc.*cd.*10e11)./(k(2)*k(3)*k(4)) + (ca.*cc.*cd)./(k(3)*k(4)) + (ca.*cb.*cc.*cd)./(k(2)*k(3)*k(4))));
% dl3,twi - dl1/2 del
t = @(k,ca,cb,cc,cd)((ca + (cb.*10e11)./52e11 + (cc.*10e11)./k(3) + (cd.*10e11)./k(4) + (ca.*cb)./52e11 + (cb.*cc.*10e11)./(52e11*k(3)) + (ca.*cc)./k(3) + (ca.*cd)./k(4) +....
    (cb.*cd.*10e11)./(52e11*k(4)) + (cc.*cd.*10e11)./(k(3)*k(4)) + (ca.*cb.*cc)./(52e11*k(3)) + (ca.*cc.*cd)./(k(3)*k(4)) + ...
    (cb.*cc.*cd.*10e11)./(52e11*k(3)*k(4)) + (ca.*cc.*cd)./(k(3)*k(4)) + (ca.*cb.*cc.*cd)./(52e11*k(3)*k(4)))./...
    (10e11 + ca + (cb.*10e11)./52e11 + (cc.*10e11)./k(3) + (cd.*10e11)./k(4) + (ca.*cb)./52e11 + (cb.*cc.*10e11)./(52e11*k(3)) + (ca.*cc)./k(3) + (ca.*cd)./k(4) +....
    (cb.*cd.*10e11)./(52e11*k(4)) + (cc.*cd.*10e11)./(k(3)*k(4)) + (ca.*cb.*cc)./(52e11*k(3)) + (ca.*cc.*cd)./(k(3)*k(4)) + ...
    (cb.*cc.*cd.*10e11)./(52e11*k(3)*k(4)) + (ca.*cc.*cd)./(k(3)*k(4)) + (ca.*cb.*cc.*cd)./(52e11*k(3)*k(4))));

f = @(k,ca,cb,cc,cd)((ca + (cb.*k(1))./k(2) + (cc.*k(1))./k(3) + (cd.*k(1))./k(4) + (ca.*cb)./k(2) + (cb.*cc.*k(1))./(k(2)*k(3)) + (ca.*cc)./k(3) + (ca.*cd)./k(4) +....
    (cb.*cd.*k(1))./(k(2)*k(4)) + (cc.*cd.*k(1))./(k(3)*k(4)) + (ca.*cb.*cc)./(k(2)*k(3)) + (ca.*cc.*cd)./(k(3)*k(4)) + ...
    (cb.*cc.*cd.*k(1))./(k(2)*k(3)*k(4)) + (ca.*cc.*cd)./(k(3)*k(4)) + (ca.*cb.*cc.*cd)./(k(2)*k(3)*k(4)))./...
    (k(1) + ca + (cb.*k(1))./k(2) + (cc.*k(1))./k(3) + (cd.*k(1))./k(4) + (ca.*cb)./k(2) + (cb.*cc.*k(1))./(k(2)*k(3)) + (ca.*cc)./k(3) + (ca.*cd)./k(4) +....
    (cb.*cd.*k(1))./(k(2)*k(4)) + (cc.*cd.*k(1))./(k(3)*k(4)) + (ca.*cb.*cc)./(k(2)*k(3)) + (ca.*cc.*cd)./(k(3)*k(4)) + ...
    (cb.*cc.*cd.*k(1))./(k(2)*k(3)*k(4)) + (ca.*cc.*cd)./(k(3)*k(4)) + (ca.*cb.*cc.*cd)./(k(2)*k(3)*k(4))));
obj = @(k) sum(sqrt((f(k,ca,cb,cc,cd)-2.86*m(k,ca,cb,cc,cd)).^2) + sqrt((f(k,ca,cb,cc,cd)-2.86*p(k,ca,cb,cc,cd)).^2) +...
    sqrt((f(k,ca,cb,cc,cd)-2.86*q(k,ca,cb,cc,cd)).^2) + sqrt((f(k,ca,cb,cc,cd)-2.86*r(k,ca,cb,cc,cd)).^2) + ......
    sqrt((f(k,ca,cb,cc,cd)-2.86*t(k,ca,cb,cc,cd)).^2) + sqrt((f(k,ca,cb,cc,cd)-10*s(k,ca,cb,cc,cd)).^2));
k_guess=[70,8,3,1];
% lb = zeros(1,100);
k = fmincon(obj,k_guess,[],[],[],[])

ka = k(1); kb = k(2); kc = k(3); kd = k(4); % wt
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) +  (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) + (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd);  
p = num./den; 
ka = k(1); kb = k(2); kd = k(4); kc = 34e11; %twi del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) +  (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) + (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd);  
p1 = num./den;
ka = k(1); kb = k(2); kc = 34e11; kd = 16.5e11; %dl3,twi del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) +  (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) + (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd);  
p2 = num./den; 
ka = k(1); kb = k(2); kc = k(3);  kd = 16.5e11; %dl3 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) +  (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) + (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd);  
p3 = num./den; 
ka = 10e11; kb = k(2); kc = k(3); kd = k(4);  %dl1 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) +  (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) + (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd);  
p4 = num./den; 
ka = k(1);  kc = k(3); kd = k(4); kb = 52e11;  %dl2 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) +  (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) + (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd);  
p5 = num./den;
ka = 10e11; kb = 52e11; kc = k(3); kd = k(4); %dl1/2 del
num = ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) +  (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + (ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    (cb.*cc.*cd.*ka)./(kb*kc*kd) + (ca.*cc.*cd)./(kc*kd) + (ca.*cb.*cc.*cd)./(kb*kc*kd);  
p6 = num./den;
plot(x,p); hold on; hold on; plot(x,p1); hold on; plot(x,p2); hold on; plot(x,p3); hold on; plot(x,p4); hold on; plot(x,p5); hold on; plot(x,p6);
title('Optimizing cooperativity'); legend('All four sites','Twi del','Dl3,Twi del','Dl3 del','Dl1 del','Dl2 del','Dl1/2 del');

%% 4 sites - use cooperativity as parameter in objective function -  only 3 w with zld
% Generic curves
x = 0:0.01:0.99;
ca = 400*normpdf(x,0.5,0.08)./2000;
cb = 400*normpdf(x,0.5,0.08)./2000;
cc = 0.01;
cd = 400*normpdf(x,0.5,0.08)./2000;

ka = 10; % dl1 binding
kb = 52; % dl2 binding 
kc = 1.7; % zld binding
kd = 16.5; % dl3 binding
% 1/8.1e-4; % zld binding

% dl1/2/3 - zld deletion
m = @(w,ca,cb,cc,cd)((ca + (cb.*10)./52 + (cd.*10)./16.5 + (ca.*cb)./52 + (cb.*cc.*10)./(52*1.7e11) + (ca.*cc)./1.7e11 + (ca.*cd)./16.5 +....
    (cb.*cd.*10)./(52*16.5) + (cc.*cd.*10)./(1.7e11*16.5) + w(1)*(ca.*cb.*cc)./(52*1.7e11) + (ca.*cc.*cd)./(1.7e11*16.5) + ...
    w(2)*(cb.*cc.*cd.*10)./(52*1.7e11*16.5) + (ca.*cc.*cd)./(1.7e11*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52*1.7e11*16.5))./...
    (10 + ca + (cb.*10)./52 + (cc.*10)./1.7e11 + (cd.*10)./16.5 + (ca.*cb)./52 + (cb.*cc.*10)./(52*1.7e11) +(ca.*cc)./1.7e11 + (ca.*cd)./16.5 +....
    (cb.*cd.*10)./(52*16.5) + (cc.*cd.*10)./(1.7e11*16.5) + w(1)*(ca.*cb.*cc)./(52*1.7e11) + (ca.*cc.*cd)./(1.7e11*16.5) + ...
    w(2)*(cb.*cc.*cd.*10)./(52*1.7e11*16.5) + (ca.*cc.*cd)./(1.7e11*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52*1.7e11*16.5)));
%dl1/3,zld - dl2 deletion
p = @(w,ca,cb,cc,cd)((ca + (cb.*10)./52e11 + (cd.*10)./16.5 + (ca.*cb)./52e11 + (cb.*cc.*10)./(52e11*1.7) + (ca.*cc)./1.7 +(ca.*cd)./16.5 +....
    (cb.*cd.*10)./(52e11*16.5) + (cc.*cd.*10)./(1.7*16.5) + w(1)*(ca.*cb.*cc)./(52e11*1.7) +(ca.*cc.*cd)./(1.7*16.5) + ...
    w(2)*(cb.*cc.*cd.*10)./(52e11*1.7*16.5) +  (ca.*cc.*cd)./(1.7*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52e11*1.7*16.5))./...
    (10 + ca + (cb.*10)./52e11 + (cc.*10)./1.7 + (cd.*10)./16.5 + (ca.*cb)./52e11 + (cb.*cc.*10)./(52e11*1.7) + (ca.*cc)./1.7 + (ca.*cd)./16.5 +....
    (cb.*cd.*10)./(52e11*16.5) +(cc.*cd.*10)./(1.7*16.5) + w(1)*(ca.*cb.*cc)./(52e11*1.7) + (ca.*cc.*cd)./(1.7*16.5) + ...
    w(2)*(cb.*cc.*cd.*10)./(52e11*1.7*16.5) +  (ca.*cc.*cd)./(1.7*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52e11*1.7*16.5)));
% dl2/3,zld - dl1 del 
q = @(w,ca,cb,cc,cd)((ca + (cb.*10e11)./52 + (cd.*10e11)./16.5 + (ca.*cb)./52 + (cb.*cc.*10e11)./(52*1.7) + (ca.*cc)./1.7 + (ca.*cd)./16.5 +....
    (cb.*cd.*10e11)./(52*16.5) + (cc.*cd.*10e11)./(1.7*16.5) + w(1)*(ca.*cb.*cc)./(52*1.7) + (ca.*cc.*cd)./(1.7*16.5) + ...
    w(2)*(cb.*cc.*cd.*10e11)./(52*1.7*16.5) + (ca.*cc.*cd)./(1.7*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52*1.7*16.5))./...
    (10e11 + ca + (cb.*10e11)./52 + (cc.*10e11)./1.7 + (cd.*10e11)./16.5 + (ca.*cb)./52 + (cb.*cc.*10e11)./(52*1.7) + (ca.*cc)./1.7 + (ca.*cd)./16.5 +....
    (cb.*cd.*10e11)./(52*16.5) + (cc.*cd.*10e11)./(1.7*16.5) + w(1)*(ca.*cb.*cc)./(52*1.7) + (ca.*cc.*cd)./(1.7*16.5) + ...
    w(2)*(cb.*cc.*cd.*10e11)./(52*1.7*16.5) +  (ca.*cc.*cd)./(1.7*16.5) + w(3)*(ca.*cb.*cc.*cd)./(52*1.7*16.5)));
% dl3,zld - dl1/2 del
r = @(w,ca,cb,cc,cd)((ca + (cb.*10e11)./52e11 + (cd.*10e11)./16.5 + (ca.*cb)./52e11 + (cb.*cc.*10e11)./(52e11*1.7) +(ca.*cc)./1.7 + (ca.*cd)./16.5 +....
    (cb.*cd.*10e11)./(52e11*16.5) + (cc.*cd.*10e11)./(1.7*16.5) + w(1)*(ca.*cb.*cc)./(52e11*1.7) + (ca.*cc.*cd)./(1.7*16.5) + ...
    w(2)*(cb.*cc.*cd.*10e11)./(52e11*1.7*16.5) +  (ca.*cc.*cd)./(1.7*16.5) +  w(3)*(ca.*cb.*cc.*cd)./(52e11*1.7*16.5))./...
    (10e11 + ca + (cb.*10e11)./52e11 + (cc.*10e11)./1.7 + (cd.*10e11)./16.5 + (ca.*cb)./52e11 + (cb.*cc.*10e11)./(52e11*1.7) + (ca.*cc)./1.7 + (ca.*cd)./16.5 +....
    (cb.*cd.*10e11)./(52e11*16.5) + (cc.*cd.*10e11)./(1.7*16.5) + w(1)*(ca.*cb.*cc)./(52e11*1.7) + (ca.*cc.*cd)./(1.7*16.5) + ...
    w(2)*(cb.*cc.*cd.*10e11)./(52e11*1.7*16.5) + (ca.*cc.*cd)./(1.7*16.5) +  w(3)*(ca.*cb.*cc.*cd)./(52e11*1.7*16.5)));

ka = 10;
kb = 52; 
kc = 1.7; 
kd = 16.5;
f = @(w,ka,kb,kc,kd,ca,cb,cc,cd)((ca + (cb.*ka)./kb + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + w(1)*(ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    w(2)*(cb.*cc.*cd.*ka)./(kb*kc*kd) +  (ca.*cc.*cd)./(kc*kd) +  w(3)*(ca.*cb.*cc.*cd)./(kb*kc*kd))./...
    (ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + (ca.*cb)./kb + (cb.*cc.*ka)./(kb*kc) + (ca.*cc)./kc + (ca.*cd)./kd +....
    (cb.*cd.*ka)./(kb*kd) + (cc.*cd.*ka)./(kc*kd) + w(1)*(ca.*cb.*cc)./(kb*kc) + (ca.*cc.*cd)./(kc*kd) + ...
    w(2)*(cb.*cc.*cd.*ka)./(kb*kc*kd) + (ca.*cc.*cd)./(kc*kd) +  w(3)*(ca.*cb.*cc.*cd)./(kb*kc*kd)));
obj = @(w) sum(sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*m(w,ca,cb,cc,cd)).^2) + sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.866*p(w,ca,cb,cc,cd)).^2) +...
    sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*q(w,ca,cb,cc,cd)).^2) + sqrt((f(w,ka,kb,kc,kd,ca,cb,cc,cd)-2.86*r(w,ca,cb,cc,cd)).^2));
w_guess=ones(1,3);
lb = ones(1,10);
w = fmincon(obj,w_guess,[],[],[],[],lb)

w1 = 1; w2 = 1; w3 = 1; w4 = 1; w5 = 1; w6 = 1; w7 = w(1); w8 = 1; w9 = w(2); w10 = 1; w11 = w(3);

num = ca + (cb.*ka)./kb + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) +  w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) +  w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd);  
p = num./den; 
ka = 10; kb = 52; kc = 1.7e11; kd = 16.5; %zld del
num = ca + (cb.*ka)./kb + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p1 = num./den;
ka = 10; kb = 52e11; kc = 1.7; kd = 16.5; %dl2 del
num = ca + (cb.*ka)./kb + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p2 = num./den;
ka = 10e11; kb = 52; kc = 1.7; kd = 16.5; %dl1 del
num = ca + (cb.*ka)./kb + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p3 = num./den;
ka = 10e11; kb = 52e11; kc = 1.7; kd = 16.5; %dl1/2 del
num = ca + (cb.*ka)./kb + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
den = ka + ca + (cb.*ka)./kb + (cc.*ka)./kc + (cd.*ka)./kd + w1*(ca.*cb)./kb + w2*(cb.*cc.*ka)./(kb*kc) + w3*(ca.*cc)./kc + w4*(ca.*cd)./kd +....
    w5*(cb.*cd.*ka)./(kb*kd) + w6*(cc.*cd.*ka)./(kc*kd) + w7*(ca.*cb.*cc)./(kb*kc) + w8*(ca.*cc.*cd)./(kc*kd) + ...
    w9*(cb.*cc.*cd.*ka)./(kb*kc*kd) + w10*(ca.*cc.*cd)./(kc*kd) + w11*(ca.*cb.*cc.*cd)./(kb*kc*kd); 
p4 = num./den;
plot(x,p); hold on; plot(x,p1);  hold on; plot(x,p2); hold on; plot(x,p3); hold on; plot(x,p4);
title('Optimizing cooperativity'); legend('All four sites','Zld del','Dl2 del','Dl1 del','Dl1/2 del');


